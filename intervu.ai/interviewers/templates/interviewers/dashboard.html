{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interviewer Dashboard | Intervu.AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-primary': '#0B0F19',
                        'dark-secondary': '#1A1F2E',
                        'dark-accent': '#252A3A',
                        'purple-primary': '#6366F1',
                        'purple-secondary': '#8B5CF6',
                        'teal-accent': '#14B8A6',
                        'emerald-accent': '#10B981',
                        'slate-800': '#1E293B',
                        'slate-700': '#334155',
                        'slate-600': '#475569',
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, #6366F1 0%, #8B5CF6 50%, #14B8A6 100%)',
                        'gradient-secondary': 'linear-gradient(135deg, #1E293B 0%, #334155 100%)',
                        'gradient-glass': 'linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)',
                    },
                    animation: {
                        'float': 'float 20s infinite linear',
                        'glow': 'glow 3s ease-in-out infinite',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
                        'slide-in': 'slide-in 0.5s ease-out',
                        'fade-in': 'fade-in 0.6s ease-out',
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(99, 102, 241, 0.3)',
                        'glow-lg': '0 0 40px rgba(99, 102, 241, 0.4)',
                        'neon': '0 0 5px rgba(20, 184, 166, 0.5), 0 0 20px rgba(20, 184, 166, 0.3), 0 0 35px rgba(20, 184, 166, 0.2)',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(99, 102, 241, 0.5); }
            50% { text-shadow: 0 0 30px rgba(139, 92, 246, 0.8); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .particle {
            position: absolute;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .neon-border {
            border: 2px solid transparent;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(20, 184, 166, 0.1)) border-box;
            border-image: linear-gradient(135deg, #6366F1, #14B8A6) 1;
        }
        .scrollbar-custom::-webkit-scrollbar {
            width: 8px;
        }
        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6366F1, #14B8A6);
            border-radius: 10px;
        }
        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8B5CF6, #10B981);
        }
    </style>
</head>
<body class="bg-dark-primary text-white min-h-screen overflow-x-hidden">
    <!-- Animated Background -->
    <div class="fixed inset-0 bg-gradient-to-br from-dark-primary via-dark-secondary to-dark-accent opacity-90 -z-10"></div>
    
    <!-- Floating particles -->
    <div class="particles fixed inset-0 pointer-events-none -z-10"></div>

    <!-- Navigation -->
    <nav class="glass-effect sticky top-0 z-50 py-4 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <a href="/" class="flex items-center space-x-2 hover:scale-105 transition-transform duration-300">
                <span class="text-2xl font-bold bg-gradient-to-r from-purple-primary to-teal-accent bg-clip-text text-transparent animate-glow">
                    Intervu.AI
                </span>
            </a>
            
            <div class="hidden md:flex items-center space-x-6">
                <a href="{% url 'interviewer_dashboard' %}" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-primary to-teal-accent text-white font-medium hover:shadow-glow transition-all duration-300">
                    Dashboard
                </a>
                <a href="/notfound/" class="text-gray-300 hover:text-white transition-colors duration-300">Interviews</a>
                <a href="/notfound/" class="text-gray-300 hover:text-white transition-colors duration-300">Resources</a>
                <a href="{% url 'interviewer_profile' %}" class="px-4 py-2 bg-gradient-to-r from-emerald-accent to-teal-accent text-white rounded-lg hover:shadow-lg hover:shadow-emerald-accent/25 hover:scale-105 transition-all duration-300">
                    My Profile
                </a>
            </div>
            
            <div class="md:hidden">
                <button onclick="toggleMobileMenu()" class="text-white focus:outline-none">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-300">
        <div class="glass-effect rounded-3xl p-8 max-w-md w-full mx-4 transform scale-95 transition-all duration-300">
            <div class="text-center">
                <div class="w-20 h-20 bg-gradient-to-r from-emerald-accent to-teal-accent rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse-glow">
                    <i id="modalIcon" class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 id="modalTitle" class="text-2xl font-bold text-white mb-4">Success!</h3>
                <p id="modalMessage" class="text-gray-300 mb-6">Operation completed successfully.</p>
                <button onclick="closeModal()" class="px-6 py-3 bg-gradient-to-r from-purple-primary to-teal-accent text-white rounded-xl hover:shadow-glow hover:scale-105 transition-all duration-300">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-7xl mx-auto">
            <!-- Dashboard Header -->
            <div class="text-center mb-12 animate-fade-in">
                <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-primary to-teal-accent bg-clip-text text-transparent">
                    Interviewer Dashboard
                </h1>
                <p class="text-xl text-gray-300 max-w-2xl mx-auto">
                    Manage candidate resumes, conduct interviews, and evaluate talent with AI-powered insights.
                </p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="glass-effect rounded-2xl p-6 hover:shadow-glow transition-all duration-300 animate-slide-in">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">{{ candidates|length }}</h3>
                            <p class="text-gray-400">Total Candidates</p>
                        </div>
                        <div class="p-3 bg-gradient-to-r from-purple-primary to-purple-secondary rounded-full">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-2xl p-6 hover:shadow-glow transition-all duration-300 animate-slide-in" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">
                                {% with resume_count=0 %}
                                    {% for candidate in candidates %}
                                        {% if candidate.resume %}
                                            {% with resume_count=resume_count|add:1 %}{% endwith %}
                                        {% endif %}
                                    {% endfor %}
                                    {{ resume_count }}
                                {% endwith %}
                            </h3>
                            <p class="text-gray-400">Resumes Uploaded</p>
                        </div>
                        <div class="p-3 bg-gradient-to-r from-teal-accent to-emerald-accent rounded-full">
                            <i class="fas fa-file-alt text-white text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-2xl p-6 hover:shadow-glow transition-all duration-300 animate-slide-in" style="animation-delay: 0.4s;">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">
                                {% with meeting_count=0 %}
                                    {% for candidate in candidates %}
                                        {% if candidate.meeting_link %}
                                            {% with meeting_count=meeting_count|add:1 %}{% endwith %}
                                        {% endif %}
                                    {% endfor %}
                                    {{ meeting_count }}
                                {% endwith %}
                            </h3>
                            <p class="text-gray-400">Scheduled Meetings</p>
                        </div>
                        <div class="p-3 bg-gradient-to-r from-emerald-accent to-purple-primary rounded-full">
                            <i class="fas fa-calendar-check text-white text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Candidates Section -->
            <div class="glass-effect rounded-3xl p-8 mb-8 animate-fade-in">
                <div class="flex items-center mb-8">
                    <div class="p-3 bg-gradient-to-r from-purple-primary to-teal-accent rounded-full mr-4">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-primary to-teal-accent bg-clip-text text-transparent">
                        Candidate Resumes
                    </h2>
                </div>
                
                {% if candidates %}
                <div class="space-y-8">
                    {% for candidate in candidates %}
                    <div class="glass-effect rounded-2xl p-6 card-hover border border-white/10 hover:border-purple-primary/50 transition-all duration-300">
                        <!-- Candidate Header -->
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-gradient-to-r from-purple-primary to-teal-accent rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-bold text-white">{{ candidate.user.username }}</h3>
                                    <p class="text-gray-400">Candidate Resume</p>
                                </div>
                            </div>
                            <a href="{% url 'view_candidate_profile' candidate.id %}" 
                               class="px-6 py-3 bg-gradient-to-r from-purple-primary to-teal-accent text-white rounded-lg hover:shadow-glow hover:scale-105 transition-all duration-300 flex items-center space-x-2">
                                <i class="fas fa-user"></i>
                                <span>View Profile</span>
                            </a>
                        </div>

                        {% if candidate.resume %}
                        <!-- Resume Actions -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <a href="{{ candidate.resume.url }}" 
                               class="flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-emerald-accent to-teal-accent text-white rounded-lg hover:shadow-lg hover:shadow-emerald-accent/25 hover:scale-105 transition-all duration-300">
                                <i class="fas fa-download"></i>
                                <span>Download Resume</span>
                            </a>
                            
                            <form method="post" class="w-full" onsubmit="return handleQuestionGeneration(event)">
                                {% csrf_token %}
                                <input type="hidden" name="resume_id" value="{{ candidate.id }}">
                                <button type="submit" name="generate_questions" 
                                        class="w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-secondary to-purple-primary text-white rounded-lg hover:shadow-lg hover:shadow-purple-primary/25 hover:scale-105 transition-all duration-300">
                                    <i class="fas fa-brain"></i>
                                    <span>Generate Questions</span>
                                </button>
                            </form>
                            
                            <form method="post" class="w-full lg:col-span-2" onsubmit="return handleMeetingScheduling(event)">
                                {% csrf_token %}
                                <input type="hidden" name="resume_id" value="{{ candidate.id }}">
                                <div class="flex space-x-2">
                                    <input type="datetime-local" name="start_time" required 
                                           class="flex-1 px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-primary focus:border-transparent transition-all duration-300">
                                    <button type="submit" name="schedule_meeting" 
                                            class="px-6 py-3 bg-gradient-to-r from-teal-accent to-emerald-accent text-white rounded-lg hover:shadow-lg hover:shadow-teal-accent/25 hover:scale-105 transition-all duration-300 flex items-center space-x-2">
                                        <i class="fas fa-calendar-plus"></i>
                                        <span>Schedule</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        {% if candidate.meeting_link %}
                        <!-- Meeting Details -->
                        <div class="bg-gradient-to-r from-purple-primary/10 to-teal-accent/10 rounded-xl p-6 mb-6 border border-purple-primary/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-xl font-bold text-white flex items-center">
                                    <i class="fas fa-video text-teal-accent mr-3"></i>
                                    Meeting Details
                                </h4>
                                <form method="get" action="{% url 'interviewer_analysis' %}">
                                    <input type="hidden" name="resume_id" value="{{ candidate.id }}">
                                    <button type="submit" 
                                            class="px-4 py-2 bg-gradient-to-r from-purple-primary to-teal-accent text-white rounded-lg hover:shadow-glow hover:scale-105 transition-all duration-300 flex items-center space-x-2">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Analyze</span>
                                    </button>
                                </form>
                            </div>
                            <div class="bg-white/5 rounded-lg p-4">
                                <p class="text-gray-300 mb-2">Meeting Link:</p>
                                <a href="{{ candidate.meeting_link }}" target="_blank" 
                                   class="text-teal-accent hover:text-purple-primary transition-colors duration-300 break-all">
                                    {{ candidate.meeting_link }}
                                </a>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if questions and candidate.id|stringformat:"s" in questions %}
                        <!-- Generated Questions -->
                        <div class="bg-gradient-to-r from-slate-800/50 to-slate-700/50 rounded-2xl border border-purple-primary/20 overflow-hidden shadow-lg hover:shadow-purple-primary/10 transition-all duration-300">
                            <div class="flex items-center justify-between px-6 py-4 bg-gradient-to-r from-purple-primary/20 to-teal-accent/20 border-b border-purple-primary/20">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-r from-purple-primary to-teal-accent rounded-full flex items-center justify-center">
                                        <i class="fas fa-brain text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-xl font-bold text-white">AI Generated Questions</h4>
                                        <p class="text-gray-300 text-sm">Tailored interview questions based on resume analysis</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="px-3 py-1 bg-gradient-to-r from-emerald-accent/20 to-teal-accent/20 rounded-full border border-emerald-accent/30">
                                        <span class="text-emerald-accent text-sm font-medium">Ready to Use</span>
                                    </div>
                                    <button onclick="copyToClipboard(this, '{{ questions|get_item:candidate.id }}')" 
                                            class="px-4 py-2 bg-gradient-to-r from-purple-primary to-teal-accent text-white rounded-lg hover:shadow-glow hover:scale-105 transition-all duration-300 flex items-center space-x-2">
                                        <i class="fas fa-copy"></i>
                                        <span>Copy All</span>
                                    </button>
                                </div>
                            </div>
                            <div class="max-h-96 overflow-y-auto scrollbar-custom">
                                <div class="p-6 space-y-6">
                                    <div class="questions-formatted text-gray-300 leading-relaxed">
                                        {{ questions|get_item:candidate.id|safe }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% else %}
                        <!-- No Resume -->
                        <div class="text-center py-12">
                            <div class="w-20 h-20 bg-gradient-to-r from-gray-600 to-gray-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-circle text-white text-2xl"></i>
                            </div>
                            <p class="text-gray-400 text-lg">No resume uploaded yet.</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- No Candidates -->
                <div class="text-center py-20">
                    <div class="w-32 h-32 bg-gradient-to-r from-purple-primary to-teal-accent rounded-full flex items-center justify-center mx-auto mb-8 animate-pulse-glow">
                        <i class="fas fa-users text-white text-4xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-4">No Candidates Yet</h3>
                    <p class="text-gray-400 text-lg max-w-md mx-auto">
                        When candidates upload their resumes, they'll appear here for your review and interview scheduling.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="glass-effect py-8 mt-12">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="flex justify-center space-x-8 mb-4">
                <a href="/privacy/" class="text-gray-400 hover:text-white transition-colors duration-300 flex items-center space-x-2">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacy Policy</span>
                </a>
                <a href="/terms/" class="text-gray-400 hover:text-white transition-colors duration-300 flex items-center space-x-2">
                    <i class="fas fa-file-contract"></i>
                    <span>Terms of Service</span>
                </a>
                <a href="/contact/" class="text-gray-400 hover:text-white transition-colors duration-300 flex items-center space-x-2">
                    <i class="fas fa-envelope"></i>
                    <span>Contact Us</span>
                </a>
            </div>
            <p class="text-gray-500">&copy; 2025 Intervu.AI. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Create floating particles
        function createParticles() {
            const particles = document.querySelector('.particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 3 + 1 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particles.appendChild(particle);
            }
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            // Implementation for mobile menu
            console.log('Mobile menu toggled');
        }

        // Copy to clipboard function
        function copyToClipboard(button, text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalContent = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> <span>Copied!</span>';
                button.classList.add('bg-gradient-to-r', 'from-emerald-accent', 'to-teal-accent');
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('from-emerald-accent', 'to-teal-accent');
                }, 2000);
            });
        }

        // Enhanced markdown formatting for questions
        function formatMarkdown() {
            const markdownContainers = document.querySelectorAll('.markdown');
            markdownContainers.forEach(container => {
                let content = container.textContent.trim();
                container.innerHTML = marked.parse(content);
            });
            
            // Format questions specifically
            const questionsContainers = document.querySelectorAll('.questions-formatted');
            questionsContainers.forEach(container => {
                let content = container.textContent.trim();
                
                // Remove ALL # symbols first
                content = content.replace(/#/g, '');
                
                // Enhanced formatting for questions with better structure and clear separation
                content = content
                    // Handle ### headings (categories/sections) - More prominent styling
                    .replace(/^###\s*(.+?)$/gm, '<div class="category-section mb-6 mt-6 first:mt-0"><div class="category-header bg-gradient-to-r from-purple-primary/15 to-teal-accent/15 rounded-xl p-5 border-2 border-purple-primary/30 mb-4 shadow-lg"><h3 class="text-2xl font-bold bg-gradient-to-r from-purple-primary to-teal-accent bg-clip-text text-transparent flex items-center"><i class="fas fa-folder-open text-purple-primary mr-3 text-xl"></i>$1</h3><div class="w-full h-px bg-gradient-to-r from-purple-primary/30 to-teal-accent/30 mt-2"></div></div>')
                    
                    // Handle ## headings (main sections) - More prominent styling
                    .replace(/^##\s*(.+?)$/gm, '<div class="main-section mb-8 mt-6 first:mt-0"><div class="main-header bg-gradient-to-r from-teal-accent/15 to-emerald-accent/15 rounded-xl p-6 border-2 border-teal-accent/30 mb-5 shadow-lg"><h2 class="text-3xl font-bold bg-gradient-to-r from-teal-accent to-emerald-accent bg-clip-text text-transparent flex items-center"><i class="fas fa-star text-yellow-400 mr-3 text-xl"></i>$1</h2><div class="w-full h-px bg-gradient-to-r from-teal-accent/30 to-emerald-accent/30 mt-3"></div></div>')
                    
                    // Handle difficulty levels with much better styling and separation
                    .replace(/\*\*(Easy|Beginner|Basic)\*\*/gi, '<div class="difficulty-section mb-4 mt-4"><div class="difficulty-badge-container bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-xl p-4 border border-green-500/20 mb-3"><div class="flex items-center justify-center"><span class="inline-flex items-center px-6 py-3 rounded-full text-lg font-bold bg-gradient-to-r from-green-500/30 to-emerald-500/30 text-green-300 border-2 border-green-500/50 shadow-xl"><i class="fas fa-seedling mr-2 text-xl"></i>$1 Level Questions</span></div></div>')
                    .replace(/\*\*(Medium|Intermediate|Moderate)\*\*/gi, '<div class="difficulty-section mb-4 mt-4"><div class="difficulty-badge-container bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-xl p-4 border border-yellow-500/20 mb-3"><div class="flex items-center justify-center"><span class="inline-flex items-center px-6 py-3 rounded-full text-lg font-bold bg-gradient-to-r from-yellow-500/30 to-orange-500/30 text-yellow-300 border-2 border-yellow-500/50 shadow-xl"><i class="fas fa-fire mr-2 text-xl"></i>$1 Level Questions</span></div></div>')
                    .replace(/\*\*(Hard|Advanced|Difficult|Expert)\*\*/gi, '<div class="difficulty-section mb-4 mt-4"><div class="difficulty-badge-container bg-gradient-to-r from-red-500/10 to-pink-500/10 rounded-xl p-4 border border-red-500/20 mb-3"><div class="flex items-center justify-center"><span class="inline-flex items-center px-6 py-3 rounded-full text-lg font-bold bg-gradient-to-r from-red-500/30 to-pink-500/30 text-red-300 border-2 border-red-500/50 shadow-xl"><i class="fas fa-rocket mr-2 text-xl"></i>$1 Level Questions</span></div></div>')
                    
                    // Format numbered questions with better styling
                    .replace(/^(\d+)\.\s*(.+?)$/gm, '<div class="question-item bg-gradient-to-r from-white/5 to-white/2 rounded-xl p-4 mb-3 border border-white/10 hover:border-purple-primary/30 transition-all duration-300 group"><div class="flex items-start space-x-3"><span class="inline-flex items-center justify-center w-8 h-8 bg-gradient-to-r from-purple-primary to-teal-accent rounded-full text-white font-bold text-sm flex-shrink-0 shadow-lg">$1</span><div class="flex-1"><p class="text-white font-medium leading-relaxed">$2</p></div></div></div>')
                    
                    // Format remaining bold text
                    .replace(/\*\*(.+?)\*\*/g, '<span class="font-bold text-white bg-gradient-to-r from-purple-primary/10 to-teal-accent/10 px-2 py-1 rounded">$1</span>')
                    
                    // Format italic text
                    .replace(/\*(.+?)\*/g, '<span class="italic text-gray-300">$1</span>')
                    
                    // Format bullet points with better styling
                    .replace(/^-\s*(.+?)$/gm, '<div class="bullet-point flex items-start space-x-3 mb-2 ml-4 p-2 rounded-lg hover:bg-white/5 transition-colors duration-200"><div class="w-2 h-2 bg-gradient-to-r from-teal-accent to-emerald-accent rounded-full mt-1 flex-shrink-0"></div><span class="text-gray-300 leading-relaxed">$1</span></div>')
                    
                    // Format code blocks
                    .replace(/`([^`]+)`/g, '<code class="bg-dark-accent px-2 py-1 rounded text-emerald-accent font-mono text-sm border border-emerald-accent/20">$1</code>')
                    
                    // Close difficulty sections
                    .replace(/(<div class="difficulty-section[^>]*>[\s\S]*?)(?=<div class="difficulty-section|<div class="category-section|<div class="main-section|$)/g, '$1</div>')
                    
                    // Close any open divs and clean up
                    .replace(/(<div class="category-section[^>]*>[\s\S]*?)(?=<div class="category-section|<div class="main-section|$)/g, '$1</div>')
                    .replace(/(<div class="main-section[^>]*>[\s\S]*?)(?=<div class="main-section|<div class="category-section|$)/g, '$1</div>')
                    
                    // Clean up excessive line breaks
                    .replace(/\n\s*\n\s*\n/g, '<br>')
                    .replace(/\n\s*\n/g, '<br>')
                    .replace(/\n/g, ' ');
                
                container.innerHTML = content;
                
                // Add interactive effects to questions
                const questionItems = container.querySelectorAll('.question-item');
                questionItems.forEach((item, index) => {
                    // Hover effects
                    item.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateX(6px) scale(1.01)';
                        this.style.boxShadow = '0 6px 20px rgba(99, 102, 241, 0.15)';
                    });
                    
                    item.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateX(0) scale(1)';
                        this.style.boxShadow = 'none';
                    });
                    
                    // Click to copy individual question
                    item.addEventListener('click', function() {
                        const questionText = this.textContent;
                        navigator.clipboard.writeText(questionText).then(() => {
                            // Show success feedback
                            const originalBg = this.style.background;
                            this.style.background = 'linear-gradient(to right, rgba(16, 185, 129, 0.2), rgba(20, 184, 166, 0.2))';
                            
                            // Add checkmark temporarily
                            const checkmark = document.createElement('i');
                            checkmark.className = 'fas fa-check text-emerald-accent ml-2';
                            this.querySelector('.flex-1').appendChild(checkmark);
                            
                            setTimeout(() => {
                                this.style.background = originalBg;
                                if (checkmark.parentNode) {
                                    checkmark.remove();
                                }
                            }, 1500);
                        });
                    });
                    
                    // Add staggered animation
                    item.style.animationDelay = `${index * 0.05}s`;
                    item.classList.add('animate-slide-in');
                });
                
                // Add effects to difficulty badges
                const difficultyBadges = container.querySelectorAll('.difficulty-badge-container');
                difficultyBadges.forEach((badge, index) => {
                    badge.style.animationDelay = `${index * 0.1}s`;
                    badge.classList.add('animate-fade-in');
                    
                    // Add hover glow effect
                    const span = badge.querySelector('span');
                    if (span) {
                        span.addEventListener('mouseenter', function() {
                            this.style.transform = 'scale(1.05)';
                            this.style.boxShadow = '0 0 25px rgba(99, 102, 241, 0.4)';
                        });
                        
                        span.addEventListener('mouseleave', function() {
                            this.style.transform = 'scale(1)';
                            this.style.boxShadow = 'none';
                        });
                    }
                });
                
                // Add effects to category and main headers
                const categoryHeaders = container.querySelectorAll('.category-header, .main-header');
                categoryHeaders.forEach((header, index) => {
                    header.style.animationDelay = `${index * 0.1}s`;
                    header.classList.add('animate-slide-in');
                    
                    // Add subtle hover effect
                    header.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                        this.style.boxShadow = '0 6px 20px rgba(99, 102, 241, 0.15)';
                    });
                    
                    header.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'none';
                    });
                });
            });
        }

        // Success Modal Functions
        function showModal(title, message, icon = 'fas fa-check') {
            const modal = document.getElementById('successModal');
            const titleEl = document.getElementById('modalTitle');
            const messageEl = document.getElementById('modalMessage');
            const iconEl = document.getElementById('modalIcon');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            iconEl.className = icon + ' text-white text-2xl';
            
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('.glass-effect').classList.remove('scale-95');
            modal.querySelector('.glass-effect').classList.add('scale-100');
            
            // Auto-close after 2 seconds
            setTimeout(() => {
                closeModal();
            }, 2000);
        }

        function closeModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.querySelector('.glass-effect').classList.remove('scale-100');
            modal.querySelector('.glass-effect').classList.add('scale-95');
        }

        // Handle form submissions
        function handleQuestionGeneration(event) {
            // Store the action in sessionStorage to show modal after page reload
            sessionStorage.setItem('showQuestionModal', 'true');
            return true;
        }

        function handleMeetingScheduling(event) {
            // Store the action in sessionStorage to show modal after page reload
            sessionStorage.setItem('showMeetingModal', 'true');
            return true;
        }

        // Check for session storage flags and show appropriate modals
        function checkAndShowModals() {
            // Check if we should show question generation modal
            if (sessionStorage.getItem('showQuestionModal') === 'true') {
                sessionStorage.removeItem('showQuestionModal');
                // Check if questions actually exist for any candidate
                const questionsExist = document.querySelector('.questions-formatted');
                if (questionsExist) {
                    showModal(
                        'Questions Generated!', 
                        'AI has successfully generated interview questions based on the candidate\'s resume. You can now review and use them for the interview.',
                        'fas fa-brain'
                    );
                }
            }
            
            // Check if we should show meeting scheduling modal
            if (sessionStorage.getItem('showMeetingModal') === 'true') {
                sessionStorage.removeItem('showMeetingModal');
                // Check if any meeting links exist
                const meetingExists = document.querySelector('a[href*="zoom"]') || document.querySelector('a[href*="meet"]') || document.querySelector('a[href*="meeting"]');
                if (meetingExists) {
                    showModal(
                        'Meeting Scheduled!', 
                        'The interview meeting has been successfully scheduled. Meeting link has been generated and is ready to use.',
                        'fas fa-calendar-check'
                    );
                }
            }
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            formatMarkdown();
            
            // Check and show modals after page load
            setTimeout(() => {
                checkAndShowModals();
            }, 500);
        });
    </script>
</body>
</html>